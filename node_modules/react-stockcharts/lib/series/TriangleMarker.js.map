{"version":3,"sources":["../../../../src/lib/series/TriangleMarker.js"],"names":["React","PropTypes","hexToRGBA","functor","Triangle","props","className","strokeWidth","opacity","point","width","rotation","getRotationInDegrees","fillColor","getFillColor","strokeColor","getStrokeColor","w","datum","x","y","getTrianglePoints","innerOpposite","innerHypotenuse","points","propTypes","direction","oneOfType","oneOf","func","isRequired","stroke","string","fill","number","shape","object","defaultProps","drawOnCanvas","ctx","strokeStyle","lineWidth","fillStyle","drawOnCanvasWithNoStateChange","rotationDeg","beginPath","moveTo","lineTo","save","translate","rotate","Math","PI","restore","cos","tan","Function","directionVal"],"mappings":"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","file":"TriangleMarker.js","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { hexToRGBA, functor } from \"../utils\";\n\nfunction Triangle(props) {\n\n\tconst {\n\t\tclassName, strokeWidth,\n\t\topacity, point, width\n\t} = props;\n\n\tconst rotation = getRotationInDegrees(props, point);\n\tif (rotation == null) return null;\n\n\tconst fillColor = getFillColor(props);\n\tconst strokeColor = getStrokeColor(props);\n\n\tconst w = functor(width)(point.datum);\n\tconst { x, y } = point;\n\tconst { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n\tconst points = `\n\t\t${x} ${y - innerHypotenuse},\n\t\t${x + (w / 2)} ${y + innerOpposite},\n\t\t${x - (w / 2)} ${y + innerOpposite}\n\t`;\n\n\treturn (\n\t\t<polygon\n\t\t\tclassName={className}\n\t\t\tpoints={points}\n\t\t\tstroke={strokeColor}\n\t\t\tstrokeWidth={strokeWidth}\n\t\t\tfillOpacity={opacity}\n\t\t\tfill={fillColor}\n\t\t\ttransform={rotation !== 0 ? `rotate(${ rotation }, ${ x }, ${ y })` : null}\n\t\t/>\n\t);\n}\nTriangle.propTypes = {\n\tdirection: PropTypes.oneOfType( [\n\t\tPropTypes.oneOf( [\n\t\t\t\"top\",\n\t\t\t\"bottom\",\n\t\t\t\"left\",\n\t\t\t\"right\",\n\t\t\t\"hide\"] ),\n\t\tPropTypes.func\n\t] ).isRequired,\n\tstroke: PropTypes.oneOfType( [\n\t\tPropTypes.string,\n\t\tPropTypes.func\n\t] ).isRequired,\n\tfill: PropTypes.oneOfType( [\n\t\tPropTypes.string,\n\t\tPropTypes.func\n\t] ).isRequired,\n\topacity: PropTypes.number.isRequired,\n\tpoint: PropTypes.shape({\n\t\tx: PropTypes.number.isRequired,\n\t\ty: PropTypes.number.isRequired,\n\t\tdatum: PropTypes.object.isRequired,\n\t}).isRequired,\n\tclassName: PropTypes.string,\n\tstrokeWidth: PropTypes.number,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.func\n\t]).isRequired\n};\nTriangle.defaultProps = {\n\tdirection: \"top\",\n\tstroke: \"#4682B4\",\n\tstrokeWidth: 1,\n\topacity: 0.5,\n\tfill: \"#4682B4\",\n\tclassName: \"react-stockcharts-marker-triangle\",\n};\nTriangle.drawOnCanvas = (props, point, ctx) => {\n\tconst { stroke, fill, opacity, strokeWidth } = props;\n\tctx.strokeStyle = stroke;\n\tctx.lineWidth = strokeWidth;\n\tif (fill !== \"none\") {\n\t\tctx.fillStyle = hexToRGBA(fill, opacity);\n\t}\n\tTriangle.drawOnCanvasWithNoStateChange(props, point, ctx);\n};\nTriangle.drawOnCanvasWithNoStateChange = (props, point, ctx) => {\n\n\tconst { width } = props;\n\tconst w = functor(width)(point.datum);\n\tconst { x, y } = point;\n\tconst { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n\tconst rotationDeg = getRotationInDegrees(props, point);\n\n\tctx.beginPath();\n\tctx.moveTo(x, y - innerHypotenuse);\n\tctx.lineTo(x + (w / 2), y + innerOpposite);\n\tctx.lineTo(x - (w / 2), y + innerOpposite);\n\tctx.stroke();\n\n\t// TODO: rotation does not work\n\t// example: https://gist.github.com/geoffb/6392450\n\tif ( rotationDeg !== null && rotationDeg !== 0 ) {\n\t\tctx.save();\n\t\tctx.translate(x, y);\n\t\tctx.rotate(rotationDeg * Math.PI / 180); // 45 degrees\n\t\tctx.fill();\n\t\tctx.restore();\n\t}\n\tctx.fill();\n};\nexport default Triangle;\n\nfunction getTrianglePoints(width) {\n\tconst innerHypotenuse = (width / 2) * (1 / Math.cos(30 * Math.PI / 180));\n\tconst innerOpposite = (width / 2) * (1 / Math.tan(60 * Math.PI / 180));\n\treturn {\n\t\tinnerOpposite,\n\t\tinnerHypotenuse\n\t};\n}\n\nfunction getFillColor( props ) {\n\tconst { fill, point } = props;\n\treturn fill instanceof Function ? fill( point.datum ) : fill;\n}\n\nfunction getStrokeColor( props ) {\n\tconst { stroke, point } = props;\n\treturn stroke instanceof Function ? stroke( point.datum ) : stroke;\n}\n\nfunction getRotationInDegrees( props, point ) {\n\tconst { direction } = props;\n\tconst directionVal = direction instanceof Function ? direction( point.datum ) : direction;\n\tif ( directionVal === \"hide\" ) return null;\n\n\tlet rotate = 0;\n\tswitch ( directionVal ) {\n\t\tcase \"bottom\":\n\t\t\trotate = 180;\n\t\t\tbreak;\n\t\tcase \"left\":\n\t\t\trotate = -90;\n\t\t\tbreak;\n\t\tcase \"right\":\n\t\t\trotate = 90;\n\t\t\tbreak;\n\t}\n\treturn rotate;\n}\n"]}